// Generated by CoffeeScript 1.4.0
(function() {
  var Capsule, REDIS, RedisMessageCapsule;

  REDIS = require('redis-url');

  Capsule = require('./capsule');

  RedisMessageCapsule = (function() {

    function RedisMessageCapsule() {}

    RedisMessageCapsule.capsules = {};

    RedisMessageCapsule.configuration = {
      redisURL: process.env.REDIS_URL || process.env.REDISTOGO_URL || 'redis://127.0.0.1:6379/',
      dbNumber: (function() {
        switch (node_env) {
          case 'production':
            return 7;
          case 'development':
            return 8;
          case 'test':
            return 9;
          default:
            return 9;
        }
      })()
    };

    RedisMessageCapsule.makeCapsuleKey = function(url, dbNum) {
      return "" + url + "." + dbNum;
    };

    RedisMessageCapsule.capsule = function(redisURL, dbNumber) {
      if (redisURL == null) {
        redisURL = null;
      }
      if (dbNumber == null) {
        dbNumber = -1;
      }
      return RedisMessageCapsule.materializeCapsule(redisURL, dbNumber);
    };

    RedisMessageCapsule.materializeCapsule = function(redisURL, dbNumber) {
      var capsule, dbNum, key, url;
      if (redisURL == null) {
        redisURL = null;
      }
      if (dbNumber == null) {
        dbNumber = -1;
      }
      url = redisURL || RedisMessageCapsule.configuration.redisURL;
      dbNum = dbNumber;
      if (dbNum < 0) {
        dbNum = RedisMessageCapsule.configuration.dbNumber;
      }
      key = RedisMessageCapsule.makeCapsuleKey(url, dbNum);
      capsule = RedisMessageCapsule.capsules[key] || (new Capsule(url, dbNum));
      return RedisMessageCapsule.capsules[key] = capsule;
    };

    RedisMessageCapsule.materialize_redis_client = function(redisURL, dbNumber) {
      var redisClient;
      redisClient = REDIS.connect(this.redisURL);
      if (redisClient != null) {
        redisClient.select(dbNumber);
      }
      return redisClient;
    };

    return RedisMessageCapsule;

  })();

  module.exports = global.RedisMessageCapsule = RedisMessageCapsule;

}).call(this);
