// Generated by CoffeeScript 1.4.0
(function() {
  var Channel, RedisMessageCapsule, node_env,
    __slice = [].slice;

  node_env = process.env.NODE_ENV || 'development';

  Channel = (function() {

    function Channel(name, redis_client) {
      this.name = name;
      this.redis_client = redis_client;
    }

    Channel.prototype.send = function(message) {
      var payload;
      payload = {
        'data': message
      };
      return this.redis_client.rpush(this.name, payload.to_json);
    };

    return Channel;

  })();

  RedisMessageCapsule = (function() {

    RedisMessageCapsule.prototype.config = {};

    function RedisMessageCapsule() {
      var dbNumber;
      if (node_env === 'production') {
        dbNumber = 7;
      }
      if (node_env === 'development') {
        dbNumber = 8;
      }
      if (node_env === 'test') {
        dbNumber = 9;
      }
      dbNumber || (dbNumber = 9);
      this.redis_clients = {};
      this.capsule_channels = {};
      this.listener_threads = {};
      this.configuration = {
        redisURL: process.env.REDIS_URL || process.env.REDISTOGO_URL || 'redis://127.0.0.1:6379/',
        redisDBNumber: dbNumber
      };
      this.config = this.configuration;
    }

    RedisMessageCapsule.prototype.make_client_key = function(url, db_num) {
      return "" + url + "." + db_num;
    };

    RedisMessageCapsule.prototype.make_channel_key = function(name, url, db_num) {
      return "" + name + "." + url + "." + db_num;
    };

    RedisMessageCapsule.prototype.make_listener_key = function() {
      var channels, db_num, url, _i;
      channels = 3 <= arguments.length ? __slice.call(arguments, 0, _i = arguments.length - 2) : (_i = 0, []), url = arguments[_i++], db_num = arguments[_i++];
      return __slice.call(channels).concat([url], [db_num]).join('.');
    };

    return RedisMessageCapsule;

  })();

  module.exports = new RedisMessageCapsule;

}).call(this);
